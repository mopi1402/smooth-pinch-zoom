var t,e;t=this,e=function(t){class e{static linear(t){return t}static easeInOut(t){return t<.5?2*t*t:(4-2*t)*t-1}static easeOut(t){return t*(2-t)}static easeIn(t){return t*t}static spring(t){const e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1}static bounce(t){const e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375}static back(t){const e=1.70158;return 1+2.70158*Math.pow(t-1,3)+e*Math.pow(t-1,2)}static elastic(t){const e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1}static get(t){return{linear:this.linear,easeInOut:this.easeInOut,easeOut:this.easeOut,easeIn:this.easeIn,spring:this.spring,bounce:this.bounce,elastic:this.elastic,back:this.back}[t]||this.easeInOut}}class i{constructor(){this.targetFPS=60,this.frameInterval=1e3/60}animate(t,i,o={}){return new Promise((s,n)=>{var l,a,r;this.cancel();const h=null!==(l=o.duration)&&void 0!==l?l:300,m=null!==(a=o.easing)&&void 0!==a?a:"easeInOut",c=i-t;if(Math.abs(c)<.001)return null===(r=o.onComplete)||void 0===r||r.call(o),void s();const u=performance.now(),d=e.get(m);this.currentAnimation={isActive:!0,startValue:t,targetValue:i,currentValue:t,duration:h};const p=e=>{var l,a,r,m,v;if(!(null===(l=this.currentAnimation)||void 0===l?void 0:l.isActive))return null===(a=o.onCancel)||void 0===a||a.call(o),void n(new Error("Animation cancelled"));const Z=Math.min((e-u)/h,1),w=d(Z),y=t+c*w;if(this.currentAnimation.currentValue=y,null===(r=o.onUpdate)||void 0===r||r.call(o,y),Z<1){const t=e+this.frameInterval;this.animationFrameId=requestAnimationFrame(e=>{e>=t?p(e):setTimeout(()=>{this.animationFrameId=requestAnimationFrame(p)},t-e)})}else this.currentAnimation.isActive=!1,this.currentAnimation=void 0,this.animationFrameId=void 0,null===(m=o.onUpdate)||void 0===m||m.call(o,i),null===(v=o.onComplete)||void 0===v||v.call(o),s()};this.animationFrameId=requestAnimationFrame(p)})}cancel(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=void 0),this.currentAnimation&&(this.currentAnimation.isActive=!1,this.currentAnimation=void 0)}isAnimating(){var t,e;return null!==(e=null===(t=this.currentAnimation)||void 0===t?void 0:t.isActive)&&void 0!==e&&e}setTargetFPS(t){this.targetFPS=Math.max(30,Math.min(120,t)),this.frameInterval=1e3/this.targetFPS}getTargetFPS(){return this.targetFPS}destroy(){this.cancel()}}const o=.5,s=2,n=1,l=.02,a=!0,r=!0,h=!0,m=!1,c={initialScale:null,minimumScale:null,maximumScale:null,userScalable:!0};class u{static parseViewportMeta(){const t={initialScale:null,minimumScale:null,maximumScale:null,userScalable:!0},e=document.querySelector('meta[name="viewport"]');if(!e)return t;const i=e.getAttribute("content");if(!i)return t;const o=i.split(",").map(t=>t.trim());for(const e of o){const[i,o]=e.split("=").map(t=>t.trim());switch(i){case"initial-scale":t.initialScale=parseFloat(o),isNaN(t.initialScale)&&(t.initialScale=null);break;case"minimum-scale":t.minimumScale=parseFloat(o),isNaN(t.minimumScale)&&(t.minimumScale=null);break;case"maximum-scale":t.maximumScale=parseFloat(o),isNaN(t.maximumScale)&&(t.maximumScale=null);break;case"user-scalable":t.userScalable="no"!==o&&"0"!==o}}return t}static hasViewportMeta(){return!!document.querySelector('meta[name="viewport"]')}static getViewportContent(){const t=document.querySelector('meta[name="viewport"]');return(null==t?void 0:t.getAttribute("content"))||null}}class d{static isSupported(){return"undefined"!=typeof window&&"visualViewport"in window&&"addEventListener"in document}static hasVisualViewport(){return"undefined"!=typeof window&&"visualViewport"in window}static hasAddEventListener(){return"undefined"!=typeof document&&"addEventListener"in document}static hasWindow(){return"undefined"!=typeof window}static hasCSSZoom(){return"undefined"!=typeof CSS&&CSS.supports("zoom","1")}static getSupportInfo(){return{hasWindow:this.hasWindow(),hasVisualViewport:this.hasVisualViewport(),hasAddEventListener:this.hasAddEventListener(),hasCSSZoom:this.hasCSSZoom(),isFullySupported:this.isSupported()}}}class p{constructor(t=document,e){this.initialDistance=0,this.initialScale=1,this.centerX=0,this.centerY=0,this.isPinching=!1,this.isZoomAllowed=!1,this.element=t,this.onPinchChange=null==e?void 0:e.onPinchChange,this.onPinchStart=null==e?void 0:e.onPinchStart,this.shouldAllowZoom=null==e?void 0:e.shouldAllowZoom,this.bindEvents()}bindEvents(){this.element.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),this.element.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),this.element.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!1})}handleTouchStart(t){var e;if(2===t.touches.length){if(this.shouldAllowZoom){if(this.isZoomAllowed=this.shouldAllowZoom("pinch",t.target||void 0),!this.isZoomAllowed)return}else this.isZoomAllowed=!0;this.isPinching=!0,this.initialDistance=this.getDistance(t.touches[0],t.touches[1]),this.initialScale=1,this.centerX=(t.touches[0].clientX+t.touches[1].clientX)/2,this.centerY=(t.touches[0].clientY+t.touches[1].clientY)/2,null===(e=this.onPinchStart)||void 0===e||e.call(this)}}handleTouchMove(t){var e;if(2===t.touches.length&&this.isPinching&&this.isZoomAllowed){t.preventDefault();const i=this.getDistance(t.touches[0],t.touches[1])/this.initialDistance;null===(e=this.onPinchChange)||void 0===e||e.call(this,i,this.centerX,this.centerY)}}handleTouchEnd(t){var e;t.touches.length<2&&this.isPinching&&(this.isPinching=!1,this.isZoomAllowed=!1,null===(e=this.onPinchEnd)||void 0===e||e.call(this))}getDistance(t,e){const i=t.clientX-e.clientX,o=t.clientY-e.clientY;return Math.sqrt(i*i+o*o)}setInitialScale(t){this.initialScale=t}destroy(){this.element.removeEventListener("touchstart",this.handleTouchStart.bind(this)),this.element.removeEventListener("touchmove",this.handleTouchMove.bind(this)),this.element.removeEventListener("touchend",this.handleTouchEnd.bind(this))}}class v{constructor(t=document,e={},i={}){this.isWheeling=!1,this.startElement=null,this.lastEventTime=0,this.lastPosition=null,this.timeout=null,this.recentDeltas=[],this.maxHistorySize=5,this.element=t,this.maxLogicalDistance=e.maxLogicalDistance||100,this.minDelay=e.minDelay||80,this.maxDelay=e.maxDelay||300,this.onStart=i.onStart,this.onWheel=i.onWheel,this.onEnd=i.onEnd,this.init()}calculateDistance(t,e){const i=e.x-t.x,o=e.y-t.y;return Math.sqrt(i*i+o*o)}calculateAdaptiveDelay(){if(0===this.recentDeltas.length)return this.maxDelay;const t=this.recentDeltas.reduce((t,e)=>t+e,0)/this.recentDeltas.length;let e;if(t<1)e=this.maxDelay;else if(t>10)e=this.minDelay;else{const i=(10-t)/9;e=this.minDelay+(this.maxDelay-this.minDelay)*i}return Math.round(e)}getMovementPhase(){if(0===this.recentDeltas.length)return"normal";const t=this.recentDeltas.reduce((t,e)=>t+e,0)/this.recentDeltas.length;return t<2?"fine-tuning":t>8?"fast":"normal"}detectNewGesture(t){const e=performance.now(),i={x:t.clientX,y:t.clientY};if(!this.isWheeling)return!0;const o=.4*this.calculateAdaptiveDelay(),s=e-this.lastEventTime;return s>o||!!(this.lastPosition&&this.calculateDistance(this.lastPosition,i)>this.maxLogicalDistance*Math.min(s/20,2))}stopGesture(t="stopped"){var e;this.isWheeling&&(this.timeout&&(clearTimeout(this.timeout),this.timeout=null),null===(e=this.onEnd)||void 0===e||e.call(this,{startElement:this.startElement,lastPosition:this.lastPosition})),this.isWheeling=!1,this.startElement=null,this.lastPosition=null,this.recentDeltas=[],this.lastEventTime=0}init(){this.element.addEventListener("wheel",t=>{var e,i,o;if(!t.ctrlKey)return void(this.isWheeling&&this.stopGesture("no-ctrl"));const s=performance.now(),n={x:t.clientX,y:t.clientY},l=Math.abs(t.deltaY||t.deltaX);this.detectNewGesture(t)&&(this.isWheeling&&(this.timeout&&clearTimeout(this.timeout),null===(e=this.onEnd)||void 0===e||e.call(this,{startElement:this.startElement,lastPosition:this.lastPosition})),this.isWheeling=!0,this.startElement=t.target,this.lastPosition=n,this.recentDeltas=[],null===(i=this.onStart)||void 0===i||i.call(this,{event:t,startElement:this.startElement,position:n})),this.recentDeltas.push(l),this.recentDeltas.length>this.maxHistorySize&&this.recentDeltas.shift();const a=this.calculateAdaptiveDelay(),r=this.getMovementPhase();null===(o=this.onWheel)||void 0===o||o.call(this,{event:t,startElement:this.startElement,currentElement:t.target,distance:this.lastPosition?this.calculateDistance(this.lastPosition,n):0,adaptiveDelay:a,phase:r}),this.lastEventTime=s,this.lastPosition=n,this.timeout&&clearTimeout(this.timeout),this.timeout=window.setTimeout(()=>{this.stopGesture("timeout")},a)},{passive:!1}),this.element.addEventListener("keyup",t=>{"Control"===t.key&&this.isWheeling&&this.stopGesture("ctrl-released")})}destroy(){this.timeout&&clearTimeout(this.timeout),this.element.removeEventListener("wheel",this.init.bind(this)),this.element.removeEventListener("keyup",this.init.bind(this))}}class Z{constructor(t,e){this.delay=t,this.callback=e,this.timeout=null}schedule(){this._clean(),this.timeout=window.setTimeout(()=>{this.callback(),this.timeout=null},this.delay)}trigger(){this.schedule()}_clean(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}destroy(){this._clean()}}class w{constructor(t){this.controls=t,this.element=this.createControl()}_calcZoom(t){return this.controls.getZoom()+t}_updateZoom(t){this.controls.animateZoom(t,{duration:300,easing:"back"})}createControl(){const t=document.createElement("div");t.className="zoom-control";const e=this.createButton("+",()=>{this._updateZoom(this._calcZoom(10))}),i=this.createZoomIndicator(),o=this.createButton("−",()=>{this._updateZoom(this._calcZoom(-10))}),s=this.createSeparator(),n=this.createSeparator(),l=this.createButton("↺",()=>{this._updateZoom(100)}),a=this.createButton("×",()=>{this.hide()});return t.appendChild(o),t.appendChild(i),t.appendChild(e),t.appendChild(s),t.appendChild(l),t.appendChild(n),t.appendChild(a),t}createButton(t,e){const i=document.createElement("button");return i.textContent=t,i.className="zoom-control-button",i.onclick=e,i}createZoomIndicator(){const t=document.createElement("div");return t.className="zoom-indicator",t.addEventListener("mousedown",t=>this.startSliderMode(t)),t.addEventListener("mouseup",()=>this.stopSliderMode()),t.addEventListener("mouseleave",()=>this.stopSliderMode()),t}createSeparator(){const t=document.createElement("div");return t.className="zoom-separator",t}updateZoom(t){const e=this.element.querySelector(".zoom-indicator");if(e){const i=Math.round(100*t);e.textContent=`${i}%`}}show(){this.element.style.opacity="1",this.element.style.transform="translateX(-50%) scale(1)",this.element.style.backdropFilter="blur(20px)",this.element.style.filter="blur(0px)"}hide(){this.element.style.opacity="0",this.element.style.transform="translateX(-50%) scale(0)",setTimeout(()=>{this.element.style.backdropFilter="blur(0px)",this.element.style.filter="blur(20px)"},200)}mount(t=document.body){const e=document.createElement("div");e.className="zoom-container",this.element.style.pointerEvents="auto",e.appendChild(this.element),document.documentElement.appendChild(e)}getElement(){return this.element}startSliderMode(t){if(!this.element.querySelector(".zoom-indicator"))return;let e=t.screenX;const i=t=>{const i=t.screenX,o=i-e;Math.abs(o)>2&&(o>0?this.controls.zoomIn(1):this.controls.zoomOut(1),e=i)},o=()=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",o)}stopSliderMode(){}destroy(){this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}var y;t.ZoomEvents=void 0,(y=t.ZoomEvents||(t.ZoomEvents={})).ZOOM_CHANGE="smoothZoomChange",y.ZOOM_APPLIED="smoothZoomApplied";class g{constructor(t,e={}){this.isHovering=!1,this.mouseOverHandler=()=>{},this.mouseOutHandler=()=>{};const{delay:i=3e3}=e;this.debouncer=function(t,e=3e3){return new Z(e,t)}(()=>{this.isHovering||this.zoomControl.hide()},i),this.zoomControl=new w(t),this.setupEventListeners(),this.zoomControl.mount()}setupEventListeners(){window.addEventListener(t.ZoomEvents.ZOOM_CHANGE,this.handleZoomEvent.bind(this));const e=this.zoomControl.getElement();this.mouseOverHandler=()=>{this.isHovering=!0,this.debouncer.destroy()},this.mouseOutHandler=t=>{e.contains(t.relatedTarget)||(this.isHovering=!1,this.debouncer.trigger())},e.addEventListener("mouseover",this.mouseOverHandler),e.addEventListener("mouseout",this.mouseOutHandler)}handleZoomEvent(e){var i;if(e.type===t.ZoomEvents.ZOOM_CHANGE){const t=e;this.zoomControl.updateZoom((null===(i=t.detail)||void 0===i?void 0:i.zoomLevel)||1)}this.zoomControl.show(),this.debouncer.trigger()}destroy(){this.debouncer.destroy(),this.zoomControl.destroy(),window.removeEventListener(t.ZoomEvents.ZOOM_CHANGE,this.handleZoomEvent.bind(this));const e=this.zoomControl.getElement();e.removeEventListener("mouseover",this.mouseOverHandler),e.removeEventListener("mouseout",this.mouseOutHandler)}}class S{static get(t,e){try{const i=localStorage.getItem(t);return i?JSON.parse(i):e||null}catch(t){return e||null}}static set(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(t){}}static remove(t){try{localStorage.removeItem(t)}catch(t){}}static clear(){try{localStorage.clear()}catch(t){}}}class E{constructor(t={}){var e,p,v,Z,w,y,E,b,f,C,A,P,D;this.currentZoom=1,this.baseZoom=1,this.isDestroyed=!1,this.isWheeling=!1,this.autoReadViewport=null!==(e=t.autoReadViewport)&&void 0!==e?e:h,this.viewportValues=this.autoReadViewport?u.parseViewportMeta():{...c},this.minZoom=null!==(v=null!==(p=t.minZoom)&&void 0!==p?p:this.viewportValues.minimumScale)&&void 0!==v?v:o,this.maxZoom=null!==(w=null!==(Z=t.maxZoom)&&void 0!==Z?Z:this.viewportValues.maximumScale)&&void 0!==w?w:s,this.initialZoom=null!==(E=null!==(y=t.initialZoom)&&void 0!==y?y:this.viewportValues.initialScale)&&void 0!==E?E:n,this.currentZoom=this.initialZoom,this.wheelIncrement=null!==(b=t.wheelIncrement)&&void 0!==b?b:l,this.customZoomApplicator=t.customZoomApplicator,this.onZoomChange=t.onZoomChange,this.enableWheelZoom=null!==(f=t.enableWheelZoom)&&void 0!==f?f:a,this.enablePinchZoom=null!==(C=t.enablePinchZoom)&&void 0!==C?C:r,this.enableZoomControl=null===(A=t.enableZoomControl)||void 0===A||A,this.enableLocalStorage=null===(P=t.enableLocalStorage)||void 0===P||P,this.useExperimentalCssZoom=null!==(D=t.useExperimentalCssZoom)&&void 0!==D?D:m,this.shouldAllowZoom=t.shouldAllowZoom,this.animationController=new i,!1!==this.enableZoomControl&&(this.zoomControlController=new g(this,{delay:3e3})),this.supportsCSSZoom=this.useExperimentalCssZoom&&d.hasCSSZoom(),this.supportsCSSZoom||(document.body.style.transformOrigin="0 0"),this.init(),this.enableLocalStorage&&window.addEventListener("beforeunload",()=>{S.set("smooth-pinch-zoom-level",this.currentZoom)})}init(){var t;this.enableLocalStorage?this.applyZoom(null!==(t=S.get("smooth-pinch-zoom-level",this.initialZoom))&&void 0!==t?t:this.initialZoom,"api"):1!==this.initialZoom&&this.applyZoom(this.initialZoom,"api"),this.enablePinchZoom&&this.setupPinchZoom(),this.enableWheelZoom&&this.setupWheelZoom()}setupPinchZoom(){window.visualViewport&&"ontouchstart"in window&&(this.touchGestureHandler=new p(document,{onPinchStart:()=>{this.baseZoom=this.currentZoom},onPinchChange:t=>{const e=this.clampZoom(this.baseZoom*t);this.applyZoom(e,"pinch")},shouldAllowZoom:this.shouldAllowZoom}))}setupWheelZoom(){this.wheelGestureHandler=new v(document,{maxLogicalDistance:100,minDelay:200,maxDelay:300},{onStart:({startElement:t})=>{this.isDestroyed||this.shouldAllowZoom&&t&&!this.shouldAllowZoom("wheel",t)||(this.isWheeling=!0)},onWheel:({event:t})=>{var e,i;if(!this.isDestroyed&&this.isWheeling&&(!(null===(e=this.shouldAllowZoom)||void 0===e?void 0:e.call(this,"wheel",null!==(i=t.target)&&void 0!==i?i:void 0))||t.ctrlKey)){t.preventDefault();const e=t.deltaY>0?-this.wheelIncrement:this.wheelIncrement,i=this.clampZoom(this.currentZoom+e);this.currentZoom=i,this.applyZoom(i,"wheel")}},onEnd:()=>{this.isWheeling=!1}})}clampZoom(t){return Math.max(this.minZoom,Math.min(this.maxZoom,t))}applyZoom(e,i){this.customZoomApplicator?this.customZoomApplicator(e):this.applyDefaultZoom(e),this.currentZoom=e;const o=100*e;this.onZoomChange&&this.onZoomChange(e,o),window.dispatchEvent(new CustomEvent(t.ZoomEvents.ZOOM_CHANGE,{detail:{zoomLevel:e,percentage:o,source:i}}))}applyDefaultZoom(e){const i=Math.abs(e-1)<.001;if(document.documentElement.style.setProperty("--zoom",e.toString()),i)this.supportsCSSZoom?document.documentElement.style.removeProperty("zoom"):(document.body.style.removeProperty("willChange"),document.body.style.removeProperty("transform"),document.body.style.removeProperty("height"),document.body.style.removeProperty("width"));else if(this.supportsCSSZoom)document.documentElement.style.zoom=e.toString();else{document.body.style.willChange="transform",document.body.style.transform=`scale(${e})`;const t=1/e;document.body.style.width=100*t+"%",document.body.style.height=100*t+"%"}window.dispatchEvent(new CustomEvent(t.ZoomEvents.ZOOM_APPLIED,{detail:{zoomLevel:e,percentage:100*e,isDefaultState:i}}))}setZoom(t){if(this.shouldAllowZoom&&!this.shouldAllowZoom("api",void 0))return;const e=t/100,i=this.clampZoom(e);this.currentZoom=i,this.applyZoom(i,"api")}getZoom(){return 100*this.currentZoom}getMinZoom(){return this.minZoom}getMaxZoom(){return this.maxZoom}resetZoom(){const t=100*this.initialZoom;this.setZoom(t)}zoomIn(t=10){this.setZoom(this.getZoom()+t)}zoomOut(t=10){this.setZoom(this.getZoom()-t)}getViewportValues(){return{...this.viewportValues}}updateViewportConstraints(t){void 0!==t.minZoom&&(this.minZoom=t.minZoom),void 0!==t.maxZoom&&(this.maxZoom=t.maxZoom),void 0!==t.initialZoom&&(this.initialZoom=t.initialZoom);const e=this.clampZoom(this.currentZoom);e!==this.currentZoom&&this.setZoom(100*e)}refreshViewportMeta(){if(!this.autoReadViewport)return;const t=u.parseViewportMeta();this.viewportValues=t,null!==t.minimumScale&&(this.minZoom=t.minimumScale),null!==t.maximumScale&&(this.maxZoom=t.maximumScale),null!==t.initialScale&&(this.initialZoom=t.initialScale)}animateZoom(t,e={}){const i=this.currentZoom,o=this.clampZoom(t/100);return this.animationController.animate(i,o,{duration:e.duration,easing:e.easing,onUpdate:t=>{this.currentZoom=t,this.applyZoom(t,"api")},onComplete:()=>{var t;this.currentZoom=o,this.applyZoom(o,"api"),null===(t=e.onComplete)||void 0===t||t.call(e)}})}cancelAnimation(){this.animationController.cancel()}isAnimating(){return this.animationController.isAnimating()}static isSupported(){return d.isSupported()}destroy(){this.isDestroyed=!0,this.animationController.destroy(),this.wheelListener&&document.removeEventListener("wheel",this.wheelListener),this.visualViewportListener&&window.visualViewport&&window.visualViewport.removeEventListener("resize",this.visualViewportListener),this.touchGestureHandler&&this.touchGestureHandler.destroy(),this.wheelGestureHandler&&this.wheelGestureHandler.destroy(),this.zoomControlController&&this.zoomControlController.destroy()}}t.SmoothPinchZoom=E,t.default=E,t.enableSmoothPinchZoom=function(t){return E.isSupported(),new E(t)},Object.defineProperty(t,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).SmoothPinchZoom={});
