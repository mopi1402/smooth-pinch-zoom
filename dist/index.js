var t,i;t=this,i=function(t,i,s,e,o,h,n,r,a,m){const c={minZoom:.5,maxZoom:2,initialZoom:1,wheelIncrement:.02,enableWheelZoom:!0,enablePinchZoom:!0,autoReadViewport:!0,enableZoomControl:!0,enableLocalStorage:!0,useExperimentalCssZoom:!1};class u{constructor(t){this.dragDetector=null,this.controls=t,this.element=this.createControl(),this.element.classList.add("hidden")}t(t){return this.controls.getZoom()+t}i(t){this.controls.animateZoom(t,{duration:300,easing:s.easeOutBack})}createControl(){const t=document.createElement("div");t.className="zoom-control";const i=this.createButton("+",()=>{this.i(this.t(10))}),s=this.createZoomIndicator(),e=this.createButton("−",()=>{this.i(this.t(-10))}),o=this.createSeparator(),h=this.createSeparator(),n=this.createButton("↺",()=>{this.i(100)}),r=this.createButton("×",()=>{this.hide()});return t.appendChild(e),t.appendChild(s),t.appendChild(i),t.appendChild(o),t.appendChild(n),t.appendChild(h),t.appendChild(r),t}createButton(t,i){const s=document.createElement("button");return s.textContent=t,s.className="zoom-control-button",s.onclick=i,s}createZoomIndicator(){const t=document.createElement("div");return t.className="zoom-indicator",this.initializeDragDetector(t),t}initializeDragDetector(t){const s={onDragLeft:t=>{this.controls.zoomOut(Math.min(.5*t,2))},onDragRight:t=>{this.controls.zoomIn(Math.min(.5*t,2))}};this.dragDetector=new i.DragDetector(s,{threshold:2,axis:"x",gestureType:"mouse",preventDefaultOnStart:!0}),this.dragDetector.attachTo(t)}createSeparator(){const t=document.createElement("div");return t.className="zoom-separator",t}updateZoom(t){const i=this.element.querySelector(".zoom-indicator");if(i){const s=Math.round(100*t);i.textContent=`${s}%`}}show(){this.element.classList.remove("hidden"),this.element.classList.add("visible")}hide(){this.element.classList.remove("visible"),this.element.classList.add("hidden")}mount(){const t=document.createElement("div");t.className="zoom-container",this.element.style.pointerEvents="auto",t.appendChild(this.element),document.documentElement.appendChild(t)}getElement(){return this.element}destroy(){this.dragDetector&&(this.dragDetector.destroy(),this.dragDetector=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}var d;t.ZoomEvents=void 0,(d=t.ZoomEvents||(t.ZoomEvents={})).ZOOM_CHANGE="smoothZoomChange",d.ZOOM_APPLIED="smoothZoomApplied";class l{constructor(i,s={}){this.isHovering=!1,this.handleZoomUpdate=i=>{if(i.type===t.ZoomEvents.ZOOM_CHANGE){const t=i;this.zoomControl.updateZoom(t.detail?.zoomLevel||1)}this.zoomControl.show(),this.isHovering||this.eventManager.trigger()},this.handleMouseEnter=()=>{this.isHovering=!0,this.eventManager.cancel()},this.handleMouseLeave=()=>{this.isHovering=!1,this.eventManager.trigger()},this.zoomControl=new u(i),this.eventManager=new e.EventDebouncerManager(()=>this.zoomControl.hide(),s.delay??3e3),this.setupEventListeners(),this.zoomControl.mount()}setupEventListeners(){window.addEventListener(t.ZoomEvents.ZOOM_CHANGE,this.handleZoomUpdate);const i=this.zoomControl.getElement();i&&(i.addEventListener("mouseenter",this.handleMouseEnter),i.addEventListener("mouseleave",this.handleMouseLeave))}destroy(){window.removeEventListener(t.ZoomEvents.ZOOM_CHANGE,this.handleZoomUpdate);const i=this.zoomControl.getElement();i&&(i.removeEventListener("mouseenter",this.handleMouseEnter),i.removeEventListener("mouseleave",this.handleMouseLeave)),this.eventManager.destroy(),this.zoomControl.destroy()}}class p{get config(){return this.o}constructor(t={}){this.currentZoom=1,this.baseZoom=1,this.isDestroyed=!1,this.isWheeling=!1;const i=t.autoReadViewport??c.autoReadViewport?n.parseViewportMeta():{};this.o={...c,...t,minZoom:t.minZoom??i?.minimumScale??c.minZoom,maxZoom:t.maxZoom??i.maximumScale??c.maxZoom,initialZoom:t.initialZoom??i.initialScale??c.initialZoom},this.animationController=new h.AnimationController,!1!==this.o.enableZoomControl&&(this.zoomControlController=new l(this,{delay:3e3})),this.supportsCSSZoom=this.o.useExperimentalCssZoom&&r.hasCSSZoom(),this.supportsCSSZoom||(document.body.style.transformOrigin="0 0"),this.init(),this.o.enableLocalStorage&&window.addEventListener("beforeunload",()=>{a.LocalStorage.set("smooth-pinch-zoom-level",this.currentZoom)})}init(){this.o.enableLocalStorage?this.applyZoom(a.LocalStorage.get("smooth-pinch-zoom-level",this.o.initialZoom)??this.o.initialZoom,"api"):1!==this.o.initialZoom&&this.applyZoom(this.o.initialZoom,"api"),this.o.enablePinchZoom&&this.setupPinchZoom(),this.o.enableWheelZoom&&this.setupWheelZoom()}setupPinchZoom(){"ontouchstart"in window&&(this.touchGestureHandler=new m.TouchGestureHandler(document,{onPinchStart:()=>{this.baseZoom=this.currentZoom},onPinchChange:t=>{const i=this.clampZoom(this.baseZoom*t);this.applyZoom(i,"pinch")},shouldAllowZoom:this.o.shouldAllowZoom}))}setupWheelZoom(){this.wheelGestureHandler=new o.WheelGestureHandler(document,{maxLogicalDistance:100,minDelay:200,maxDelay:300},{onStart:({startElement:t})=>{this.isDestroyed||this.o.shouldAllowZoom&&t&&!this.o.shouldAllowZoom("wheel",t)||(this.isWheeling=!0)},onWheel:({event:t})=>{if(!this.isDestroyed&&this.isWheeling&&(!this.o.shouldAllowZoom?.("wheel",t.target??void 0)||t.ctrlKey)){t.preventDefault();const i=t.deltaY>0?-this.o.wheelIncrement:this.o.wheelIncrement,s=this.clampZoom(this.currentZoom+i);this.currentZoom=s,this.applyZoom(s,"wheel")}},onEnd:()=>{this.isWheeling=!1}})}clampZoom(t){return Math.max(this.o.minZoom,Math.min(this.o.maxZoom,t))}applyZoom(i,s){this.o.customZoomApplicator?this.o.customZoomApplicator(i):this.applyDefaultZoom(i),this.currentZoom=i;const e=100*i;this.o.onZoomChange&&this.o.onZoomChange(i,e),window.dispatchEvent(new CustomEvent(t.ZoomEvents.ZOOM_CHANGE,{detail:{zoomLevel:i,percentage:e,source:s}}))}applyDefaultZoom(i){const s=Math.abs(i-1)<.001;if(document.documentElement.style.setProperty("--zoom",i.toString()),s)this.supportsCSSZoom?document.documentElement.style.removeProperty("zoom"):(document.body.style.removeProperty("willChange"),document.body.style.removeProperty("transform"),document.body.style.removeProperty("height"),document.body.style.removeProperty("width"));else if(this.supportsCSSZoom)document.documentElement.style.zoom=i.toString();else{document.body.style.willChange="transform",document.body.style.transform=`scale(${i})`;const t=1/i;document.body.style.width=100*t+"%",document.body.style.height=100*t+"%"}window.dispatchEvent(new CustomEvent(t.ZoomEvents.ZOOM_APPLIED,{detail:{zoomLevel:i,percentage:100*i,isDefaultState:s}}))}setZoom(t){if(this.o.shouldAllowZoom&&!this.o.shouldAllowZoom("api",void 0))return;const i=t/100,s=this.clampZoom(i);this.currentZoom=s,this.applyZoom(s,"api")}getZoom(){return 100*this.currentZoom}getMinZoom(){return this.o.minZoom}getMaxZoom(){return this.o.maxZoom}resetZoom(){const t=100*this.o.initialZoom;this.setZoom(t)}zoomIn(t=10){this.setZoom(this.getZoom()+t)}zoomOut(t=10){this.setZoom(this.getZoom()-t)}updateViewportConstraints(t){void 0!==t.minZoom&&(this.o.minZoom=t.minZoom),void 0!==t.maxZoom&&(this.o.maxZoom=t.maxZoom),void 0!==t.initialZoom&&(this.o.initialZoom=t.initialZoom);const i=this.clampZoom(this.currentZoom);i!==this.currentZoom&&this.setZoom(100*i)}animateZoom(t,i={}){const s=this.currentZoom,e=this.clampZoom(t/100);return this.animationController.animate(s,e,{duration:i.duration,easing:i.easing,onUpdate:t=>{this.currentZoom=t,this.applyZoom(t,"api")},onComplete:()=>{this.currentZoom=e,this.applyZoom(e,"api"),i.onComplete?.()}})}cancelAnimation(){this.animationController.cancel()}isAnimating(){return this.animationController.isAnimating()}destroy(){this.isDestroyed=!0,this.animationController.destroy(),this.touchGestureHandler&&this.touchGestureHandler.destroy(),this.wheelGestureHandler&&this.wheelGestureHandler.destroy(),this.zoomControlController&&this.zoomControlController.destroy()}}t.SmoothPinchZoom=p,t.default=p,Object.defineProperty(t,"h",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("pithos/gestures/drag-detector"),require("pithos/animations/ease-functions"),require("pithos/performance/event-debouncer-manager"),require("pithos/gestures/wheel-handler"),require("pithos/animations/animation-controller"),require("pithos/dom/viewport-parser"),require("pithos/dom/browser/browser-support"),require("pithos/data/storage/locale-storage"),require("pithos/gestures/touch-handler")):"function"==typeof define&&define.amd?define(["exports","pithos/gestures/drag-detector","pithos/animations/ease-functions","pithos/performance/event-debouncer-manager","pithos/gestures/wheel-handler","pithos/animations/animation-controller","pithos/dom/viewport-parser","pithos/dom/browser/browser-support","pithos/data/storage/locale-storage","pithos/gestures/touch-handler"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).SmoothPinchZoom={},t.dragDetector,t.easeFunctions,t.eventDebouncerManager,t.wheelHandler,t.animationController,t.viewportParser,t.browserSupport,t.localeStorage,t.touchHandler);
