var t,e;t=this,e=function(t){class e{static linear(t){return t}static easeInOut(t){return t<.5?2*t*t:(4-2*t)*t-1}static easeOut(t){return t*(2-t)}static easeIn(t){return t*t}static spring(t){const e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1}static bounce(t){const e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375}static back(t){const e=1.70158;return 1+2.70158*Math.pow(t-1,3)+e*Math.pow(t-1,2)}static elastic(t){const e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1}static get(t){return{linear:this.linear,easeInOut:this.easeInOut,easeOut:this.easeOut,easeIn:this.easeIn,spring:this.spring,bounce:this.bounce,elastic:this.elastic,back:this.back}[t]||this.easeInOut}}class i{constructor(){this.targetFPS=60,this.frameInterval=1e3/60}animate(t,i,o={}){return new Promise((n,s)=>{var a,r,l;this.cancel();const m=null!==(a=o.duration)&&void 0!==a?a:300,h=null!==(r=o.easing)&&void 0!==r?r:"easeInOut",c=i-t;if(Math.abs(c)<.001)return null===(l=o.onComplete)||void 0===l||l.call(o),void n();const u=performance.now(),d=e.get(h);this.currentAnimation={isActive:!0,startValue:t,targetValue:i,currentValue:t,duration:m};const p=e=>{var a,r,l,h,v;if(!(null===(a=this.currentAnimation)||void 0===a?void 0:a.isActive))return null===(r=o.onCancel)||void 0===r||r.call(o),void s(new Error("Animation cancelled"));const Z=Math.min((e-u)/m,1),w=d(Z),S=t+c*w;if(this.currentAnimation.currentValue=S,null===(l=o.onUpdate)||void 0===l||l.call(o,S),Z<1){const t=e+this.frameInterval;this.animationFrameId=requestAnimationFrame(e=>{e>=t?p(e):setTimeout(()=>{this.animationFrameId=requestAnimationFrame(p)},t-e)})}else this.currentAnimation.isActive=!1,this.currentAnimation=void 0,this.animationFrameId=void 0,null===(h=o.onUpdate)||void 0===h||h.call(o,i),null===(v=o.onComplete)||void 0===v||v.call(o),n()};this.animationFrameId=requestAnimationFrame(p)})}cancel(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=void 0),this.currentAnimation&&(this.currentAnimation.isActive=!1,this.currentAnimation=void 0)}isAnimating(){var t,e;return null!==(e=null===(t=this.currentAnimation)||void 0===t?void 0:t.isActive)&&void 0!==e&&e}setTargetFPS(t){this.targetFPS=Math.max(30,Math.min(120,t)),this.frameInterval=1e3/this.targetFPS}getTargetFPS(){return this.targetFPS}destroy(){this.cancel()}}const o=.5,n=2,s=1,a=.02,r=!0,l=!0,m=!0,h=!1,c={initialScale:null,minimumScale:null,maximumScale:null,userScalable:!0};class u{static parseViewportMeta(){const t={initialScale:null,minimumScale:null,maximumScale:null,userScalable:!0},e=document.querySelector('meta[name="viewport"]');if(!e)return t;const i=e.getAttribute("content");if(!i)return t;const o=i.split(",").map(t=>t.trim());for(const e of o){const[i,o]=e.split("=").map(t=>t.trim());switch(i){case"initial-scale":t.initialScale=parseFloat(o),isNaN(t.initialScale)&&(t.initialScale=null);break;case"minimum-scale":t.minimumScale=parseFloat(o),isNaN(t.minimumScale)&&(t.minimumScale=null);break;case"maximum-scale":t.maximumScale=parseFloat(o),isNaN(t.maximumScale)&&(t.maximumScale=null);break;case"user-scalable":t.userScalable="no"!==o&&"0"!==o}}return t}static hasViewportMeta(){return!!document.querySelector('meta[name="viewport"]')}static getViewportContent(){const t=document.querySelector('meta[name="viewport"]');return(null==t?void 0:t.getAttribute("content"))||null}}class d{static isSupported(){return"undefined"!=typeof window&&"visualViewport"in window&&"addEventListener"in document}static hasVisualViewport(){return"undefined"!=typeof window&&"visualViewport"in window}static hasAddEventListener(){return"undefined"!=typeof document&&"addEventListener"in document}static hasWindow(){return"undefined"!=typeof window}static hasCSSZoom(){return"undefined"!=typeof CSS&&CSS.supports("zoom","1")}static getSupportInfo(){return{hasWindow:this.hasWindow(),hasVisualViewport:this.hasVisualViewport(),hasAddEventListener:this.hasAddEventListener(),hasCSSZoom:this.hasCSSZoom(),isFullySupported:this.isSupported()}}}class p{constructor(t=document,e){this.initialDistance=0,this.initialScale=1,this.centerX=0,this.centerY=0,this.isPinching=!1,this.element=t,this.onPinchChange=null==e?void 0:e.onPinchChange,this.onPinchStart=null==e?void 0:e.onPinchStart,this.onPinchEnd=null==e?void 0:e.onPinchEnd,this.bindEvents()}bindEvents(){this.element.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),this.element.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),this.element.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!1})}handleTouchStart(t){var e;2===t.touches.length&&(this.isPinching=!0,this.initialDistance=this.getDistance(t.touches[0],t.touches[1]),this.initialScale=1,this.centerX=(t.touches[0].clientX+t.touches[1].clientX)/2,this.centerY=(t.touches[0].clientY+t.touches[1].clientY)/2,null===(e=this.onPinchStart)||void 0===e||e.call(this))}handleTouchMove(t){var e;if(2===t.touches.length&&this.isPinching){t.preventDefault();const i=this.getDistance(t.touches[0],t.touches[1])/this.initialDistance;null===(e=this.onPinchChange)||void 0===e||e.call(this,i,this.centerX,this.centerY)}}handleTouchEnd(t){var e;t.touches.length<2&&this.isPinching&&(this.isPinching=!1,null===(e=this.onPinchEnd)||void 0===e||e.call(this))}getDistance(t,e){const i=t.clientX-e.clientX,o=t.clientY-e.clientY;return Math.sqrt(i*i+o*o)}setInitialScale(t){this.initialScale=t}destroy(){this.element.removeEventListener("touchstart",this.handleTouchStart.bind(this)),this.element.removeEventListener("touchmove",this.handleTouchMove.bind(this)),this.element.removeEventListener("touchend",this.handleTouchEnd.bind(this))}}class v{constructor(t={}){var e,p,v,Z,w,S,g,y,f,b,P;this.currentZoom=1,this.isPinching=!1,this.baseZoom=1,this.isDestroyed=!1,this.autoReadViewport=null!==(e=t.autoReadViewport)&&void 0!==e?e:m,this.viewportValues=this.autoReadViewport?u.parseViewportMeta():{...c},this.minZoom=null!==(v=null!==(p=t.minZoom)&&void 0!==p?p:this.viewportValues.minimumScale)&&void 0!==v?v:o,this.maxZoom=null!==(w=null!==(Z=t.maxZoom)&&void 0!==Z?Z:this.viewportValues.maximumScale)&&void 0!==w?w:n,this.initialZoom=null!==(g=null!==(S=t.initialZoom)&&void 0!==S?S:this.viewportValues.initialScale)&&void 0!==g?g:s,this.currentZoom=this.initialZoom,this.wheelIncrement=null!==(y=t.wheelIncrement)&&void 0!==y?y:a,this.customZoomApplicator=t.customZoomApplicator,this.onZoomChange=t.onZoomChange,this.enableWheelZoom=null!==(f=t.enableWheelZoom)&&void 0!==f?f:r,this.enablePinchZoom=null!==(b=t.enablePinchZoom)&&void 0!==b?b:l,this.useExperimentalCssZoom=null!==(P=t.useExperimentalCssZoom)&&void 0!==P?P:h,this.animationController=new i,this.supportsCSSZoom=this.useExperimentalCssZoom&&d.hasCSSZoom(),this.supportsCSSZoom||(document.body.style.transformOrigin="0 0"),this.init()}init(){1!==this.initialZoom&&this.applyZoom(this.initialZoom,"api"),this.enablePinchZoom&&this.setupPinchZoom(),this.enableWheelZoom&&this.setupWheelZoom()}setupPinchZoom(){window.visualViewport&&"ontouchstart"in window&&(this.mobilePinchHandler=new p(document,{onPinchStart:()=>{this.isPinching=!0,this.baseZoom=this.currentZoom},onPinchChange:t=>{const e=this.clampZoom(this.baseZoom*t);this.applyZoom(e,"pinch")},onPinchEnd:()=>{this.isPinching=!1,this.currentZoom=this.getCurrentAppliedZoom()}}))}setupWheelZoom(){this.wheelListener=t=>{if(!this.isDestroyed&&t.ctrlKey){t.preventDefault();const e=t.deltaY>0?-this.wheelIncrement:this.wheelIncrement,i=this.clampZoom(this.currentZoom+e);this.currentZoom=i,this.applyZoom(i,"wheel")}},document.addEventListener("wheel",this.wheelListener,{passive:!1})}clampZoom(t){return Math.max(this.minZoom,Math.min(this.maxZoom,t))}applyZoom(t,e){this.customZoomApplicator?this.customZoomApplicator(t):this.applyDefaultZoom(t);const i=100*t;this.onZoomChange&&this.onZoomChange(t,i),window.dispatchEvent(new CustomEvent("smoothZoomChange",{detail:{zoomLevel:t,percentage:i,source:e}}))}applyDefaultZoom(t){const e=Math.abs(t-1)<.001;if(document.documentElement.style.setProperty("--zoom",t.toString()),e)this.supportsCSSZoom?document.documentElement.style.removeProperty("zoom"):(document.body.style.removeProperty("willChange"),document.body.style.removeProperty("transform"),document.body.style.removeProperty("height"),document.body.style.removeProperty("width"));else if(this.supportsCSSZoom)document.documentElement.style.zoom=t.toString();else{document.body.style.willChange="transform",document.body.style.transform=`scale(${t})`;const e=1/t;document.body.style.width=100*e+"%",document.body.style.height=100*e+"%"}window.dispatchEvent(new CustomEvent("smoothZoomApplied",{detail:{zoomLevel:t,percentage:100*t,isDefaultState:e}}))}getCurrentAppliedZoom(){if(this.supportsCSSZoom)return parseFloat(document.documentElement.style.zoom||"1");{const t=document.body.style.transform.match(/scale\(([^)]+)\)/);return t?parseFloat(t[1]):1}}setZoom(t){const e=t/100,i=this.clampZoom(e);this.currentZoom=i,this.applyZoom(i,"api")}getZoom(){return 100*this.currentZoom}getMinZoom(){return this.minZoom}getMaxZoom(){return this.maxZoom}resetZoom(){const t=100*this.initialZoom;this.setZoom(t)}zoomIn(t=10){this.setZoom(this.getZoom()+t)}zoomOut(t=10){this.setZoom(this.getZoom()-t)}getViewportValues(){return{...this.viewportValues}}updateViewportConstraints(t){void 0!==t.minZoom&&(this.minZoom=t.minZoom),void 0!==t.maxZoom&&(this.maxZoom=t.maxZoom),void 0!==t.initialZoom&&(this.initialZoom=t.initialZoom);const e=this.clampZoom(this.currentZoom);e!==this.currentZoom&&this.setZoom(100*e)}refreshViewportMeta(){if(!this.autoReadViewport)return;const t=u.parseViewportMeta();this.viewportValues=t,null!==t.minimumScale&&(this.minZoom=t.minimumScale),null!==t.maximumScale&&(this.maxZoom=t.maximumScale),null!==t.initialScale&&(this.initialZoom=t.initialScale)}animateZoom(t,e={}){const i=this.currentZoom,o=this.clampZoom(t/100);return this.animationController.animate(i,o,{duration:e.duration,easing:e.easing,onUpdate:t=>{this.currentZoom=t,this.applyZoom(t,"api")},onComplete:()=>{var t;this.currentZoom=o,this.applyZoom(o,"api"),null===(t=e.onComplete)||void 0===t||t.call(e)}})}cancelAnimation(){this.animationController.cancel()}isAnimating(){return this.animationController.isAnimating()}static isSupported(){return d.isSupported()}destroy(){this.isDestroyed=!0,this.animationController.destroy(),this.wheelListener&&document.removeEventListener("wheel",this.wheelListener),this.visualViewportListener&&window.visualViewport&&window.visualViewport.removeEventListener("resize",this.visualViewportListener),this.mobilePinchHandler&&this.mobilePinchHandler.destroy(),this.resetZoom()}}t.SmoothPinchZoom=v,t.default=v,t.enableSmoothPinchZoom=function(t){return v.isSupported(),new v(t)},Object.defineProperty(t,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).SmoothPinchZoom={});
